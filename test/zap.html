<!doctype html>
<html class="no-js" lang="">

<head>
  <meta charset="utf-8">
  <title>Test</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#fafafa">
  <link href="../dist/css/styles.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
</head>

<body>
  <ul class="nav nav-pills">
    <li class="nav-item"><a class="nav-sort-label">Sorter efter: </a></li>
    <li class="nav-item"><a data-id="title-asc" title="Sortér" href="" class="nav-link sorting">Titel <svg role="presentation">
          <use xlink:href="../dist/img/icons.svg#icon-angle-up"></use>
        </svg></a></li>
    <li class="nav-item"><a data-id="clicks-asc" title="Sorterer hits faldende" href="" class="nav-link sorting desc">Hits <svg role="presentation">
          <use xlink:href="../dist/img/icons.svg#icon-angle-up"></use>
        </svg></a></li>
    <li class="nav-item"><a data-id="dates-asc" title="Sortér dato" href="" class="nav-link sorting">Dato <svg role="presentation">
          <use xlink:href="../dist/img/icons.svg#icon-angle-up"></use>
        </svg></a></li>
    <li class="nav-item"><a data-id="rating-asc" title="Sortér rating" href="" class="nav-link sorting">Rating <svg role="presentation">
          <use xlink:href="../dist/img/icons.svg#icon-angle-up"></use>
        </svg></a></li>
    <li class="nav-item">
      <label for="categories" class="sr-only">Kategorier</label>
      <select class="form-control form-control-sm" id="categories" data-id="category-asc">
        <option value="0">Alle</option>
        <option value="2">Cand.it i multimedier</option>
        <option value="1">Spansk og Europastudier</option>
      </select>
    </li>
  </ul>

  <div id="defaultAssignments"></div>
  <script>
    jQuery(document).ready(function($) {
      var $sortHeader = $('.sorting');
      var $assignmentCategory = $('#categories');
      var allAssignments = $('#defaultAssignments');

      function sortAssignments(e) {
        // Sort assognments
        var sortOrder, getID, name, order, isAnchor;
        var target = $(e.currentTarget);
        if (target.prop("tagName").toLowerCase() == 'a') {
          isAnchor = true;
          var siblings = target.parent().siblings().find('a');
          sortOrder = target.data('id');
          getID = sortOrder.split('-');
          name = getID[0];
          order = getID[1];
        }

        var cat = $assignmentCategory.val();
        $.ajax({
          url: '../includes/downloads/sorting.php',
          type: 'POST',
          data: {
            'column': name || 'clicks',
            'sortOrder': order || 'desc',
            'category': cat
          },
          success: function(response) {
            console.log(response);
            if (isAnchor) {
              target.removeClass('asc desc');
              siblings.removeClass('asc desc');
              siblings.attr('title', 'Sortér');
              var t = target.text().toLowerCase().trim();
              if (order == 'asc') {
                target.data('id', name + '-desc');
                target.attr('title', 'Sortér ' + t + ' stigende');
                target.addClass('desc');
              } else {
                target.data('id', name + '-asc');
                target.attr('title', 'Sortér ' + t + ' faldende');
                target.addClass('asc');
              }
            }
            allAssignments.empty();
            allAssignments.hide().append(response).fadeIn(600);
          },
          error: function(xhr, status, error) {
            console.log(xhr.responseText);
          }
        });
      }

      // Sorting headers
      $sortHeader.click(function(e) {
        e.preventDefault();
        sortAssignments(e);
      });

      $assignmentCategory.on('change', function(e) {
        sortAssignments(e);
      });
    });
  </script>
</body>

</html>
